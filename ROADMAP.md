# 🗺️ Kino Development Roadmap

## 开发路线图

本文档记录 Kino 项目的开发进度和待办事项。每次开发前请先查阅此文档，完成后及时更新。

---

## 🎯 当前阶段: Phase 2 - 核心功能完善

### 优先级说明
- 🔴 **P0**: 阻塞性功能，必须立即完成
- 🟠 **P1**: 高优先级，影响核心体验
- 🟡 **P2**: 中优先级，重要但不紧急
- 🟢 **P3**: 低优先级，锦上添花

---

## 📋 Phase 2 任务清单

### 1. UI/UX 优化 🔴 P0

#### 1.1 Design System 建立
- [ ] 定义完整的颜色系统
  - [ ] 主色调 (Primary)
  - [ ] 辅助色 (Secondary/Accent)
  - [ ] 语义色 (Success/Warning/Error)
  - [ ] 中性色阶 (Gray scale)
- [ ] 定义间距系统 (Spacing scale)
- [ ] 定义字体系统 (Typography scale)
- [ ] 定义圆角系统 (Border radius)
- [ ] 定义阴影系统 (Shadow levels)
- [ ] 创建 Design Tokens 文件

#### 1.2 Dashboard 视觉升级
- [ ] 重设计 `DashboardHeader`
  - [ ] 添加品牌 Logo
  - [ ] 优化用户信息展示
  - [ ] 添加通知中心
- [ ] 优化 `DocumentStats` 卡片
  - [ ] 添加数据可视化图表 (使用 recharts)
  - [ ] 添加趋势指示器
  - [ ] 优化图标和色彩
- [ ] 重设计 `QuickActions`
  - [ ] 更大的操作卡片
  - [ ] 添加 hover 动画
  - [ ] 优化图标和描述
- [ ] 优化 `DraftDocuments`
  - [ ] 添加文档缩略图
  - [ ] 优化列表布局
  - [ ] 添加快速操作按钮
- [ ] 美化 `SubscriptionCard`
  - [ ] 渐变背景优化
  - [ ] 添加使用量进度条
  - [ ] 优化按钮样式
- [ ] 重设计 `RecentActivity`
  - [ ] 时间线样式优化
  - [ ] 添加活动图标
  - [ ] 优化文字排版

#### 1.3 Editor 体验优化
- [ ] 优化 `EditorHeader`
  - [ ] 添加保存状态指示器
  - [ ] 添加导出按钮
  - [ ] 添加分享按钮
- [ ] 优化 `EditorTabs`
  - [ ] 更明显的激活状态
  - [ ] 添加文档类型图标
  - [ ] 添加 Tab 切换动画
- [ ] 优化 `EditorForm`
  - [ ] 分组折叠面板
  - [ ] 表单验证和错误提示
  - [ ] 输入框 focus 状态优化
  - [ ] 添加字段说明 tooltip
- [ ] 优化 `DocumentPreview`
  - [ ] 添加缩放控制
  - [ ] 添加页面导航
  - [ ] 优化打印样式
  - [ ] 添加点击编辑功能 (stretch goal)
- [ ] 优化 `AIAgentSidebar`
  - [ ] 优化输入框样式
  - [ ] 添加示例提示词
  - [ ] 优化生成结果展示
  - [ ] 添加历史记录

#### 1.4 响应式优化
- [ ] Dashboard 移动端适配
  - [ ] 统计卡片堆叠布局
  - [ ] 快速操作网格调整
  - [ ] 侧边栏抽屉化
- [ ] Editor 移动端适配
  - [ ] 表单和预览切换 Tab
  - [ ] AI 侧边栏改为底部抽屉
  - [ ] 触摸手势支持
- [ ] 通用组件响应式
  - [ ] 按钮大小适配
  - [ ] 表单输入框适配
  - [ ] 卡片间距调整

#### 1.5 动画和微交互
- [ ] 页面切换过渡动画
- [ ] 按钮 hover/active 状态
- [ ] 表单输入动画
- [ ] 加载骨架屏
- [ ] Toast 通知动画
- [ ] 模态框进出动画

### 2. 数据持久化 🔴 P0

#### 2.1 后端选择和配置
- [ ] 评估后端方案
  - [ ] Firebase (推荐)
  - [ ] Supabase (备选)
  - [ ] 自建 API (不推荐)
- [ ] 创建项目和配置
- [ ] 设置环境变量
- [ ] 初始化 SDK

#### 2.2 数据库 Schema 实现
- [ ] 创建 `documents` 表
- [ ] 创建 `document_relationships` 表
- [ ] 创建 `company_settings` 表
- [ ] 创建 `ai_generations` 表
- [ ] 创建 `users` 表
- [ ] 设置索引和约束

#### 2.3 文档 CRUD 操作
- [ ] 创建文档 (Create)
  - [ ] API 函数: `createDocument()`
  - [ ] 表单提交逻辑
  - [ ] 成功/失败处理
- [ ] 读取文档 (Read)
  - [ ] API 函数: `getDocument(id)`
  - [ ] API 函数: `listDocuments(filters)`
  - [ ] 分页逻辑
- [ ] 更新文档 (Update)
  - [ ] API 函数: `updateDocument(id, data)`
  - [ ] 自动保存逻辑
  - [ ] 冲突处理
- [ ] 删除文档 (Delete)
  - [ ] API 函数: `deleteDocument(id)`
  - [ ] 软删除 vs 硬删除
  - [ ] 确认对话框

#### 2.4 文件上传
- [ ] 配置云存储 (Firebase Storage / Supabase Storage)
- [ ] Logo 上传功能
  - [ ] 图片压缩
  - [ ] 格式验证
  - [ ] 上传进度显示
- [ ] 签名上传 (Base64 → File)
- [ ] 印章上传功能
- [ ] 文件 URL 管理

#### 2.5 实时同步
- [ ] 草稿自动保存 (debounce 2s)
- [ ] 乐观更新 (Optimistic UI)
- [ ] 错误重试机制

### 3. 用户认证系统 🟠 P1

#### 3.1 认证流程
- [ ] Firebase Auth 集成
- [ ] 注册页面
  - [ ] 邮箱注册
  - [ ] Google OAuth
  - [ ] 表单验证
- [ ] 登录页面
  - [ ] 邮箱登录
  - [ ] 记住我功能
  - [ ] 忘记密码
- [ ] 登出功能
- [ ] 受保护路由 (Protected Routes)

#### 3.2 用户状态管理
- [ ] 创建 Auth Context
- [ ] 用户信息获取
- [ ] 权限检查
- [ ] 会话持久化

#### 3.3 多租户隔离
- [ ] 文档按用户过滤
- [ ] 公司设置隔离
- [ ] 数据安全规则

### 4. 文档关联系统 🟠 P1

#### 4.1 关联逻辑实现
- [ ] Quotation → Invoice 转换
  - [ ] 复制客户信息
  - [ ] 复制项目明细
  - [ ] 创建关联记录
- [ ] Quotation → Contract 转换
  - [ ] 复制基础信息
  - [ ] 生成合同条款
  - [ ] 创建关联记录
- [ ] Invoice → Receipt 自动生成
  - [ ] 支付确认触发
  - [ ] 自动填充数据
  - [ ] 添加 PAID 水印

#### 4.2 关联可视化
- [ ] 文档详情页显示关联链
- [ ] 关联文档快速跳转
- [ ] 关联关系图谱 (可选)

#### 4.3 关联数据管理
- [ ] 创建关联: `createRelationship()`
- [ ] 查询关联: `getRelatedDocuments()`
- [ ] 删除关联: `deleteRelationship()`

### 5. PDF 导出功能 🟠 P1

#### 5.1 PDF 生成
- [ ] 完善 `lib/pdf-export.ts`
- [ ] 使用 jsPDF + html2canvas
- [ ] 保留双语排版
- [ ] 嵌入图片 (Logo/签名/印章)
- [ ] 优化字体渲染

#### 5.2 导出功能
- [ ] 添加导出按钮
- [ ] 生成进度提示
- [ ] 文件命名规则
- [ ] 自动下载

#### 5.3 打印优化
- [ ] 打印样式优化
- [ ] 页面分页处理
- [ ] 打印预览

### 6. 公司设置页面 🟡 P2

#### 6.1 设置页面 UI
- [ ] 创建 `/settings` 路由
- [ ] 公司信息表单
  - [ ] 公司名称
  - [ ] 联系方式
  - [ ] 地址
  - [ ] 税号
- [ ] 品牌资产管理
  - [ ] 默认 Logo
  - [ ] 默认签名
  - [ ] 默认印章
- [ ] 支付信息设置
  - [ ] 银行账户
  - [ ] FPS 信息
  - [ ] PayMe/Alipay (可选)

#### 6.2 模板管理
- [ ] 默认条款模板
- [ ] 备注模板
- [ ] 邮件模板

#### 6.3 设置应用
- [ ] 新建文档时自动填充
- [ ] 设置优先级逻辑
- [ ] 设置导入/导出

### 7. 订阅系统 🟡 P2

#### 7.1 免费额度管理
- [ ] 文档计数逻辑
- [ ] 额度检查中间件
- [ ] 额度用尽提示
- [ ] 升级引导

#### 7.2 Stripe 集成
- [ ] Stripe 账户配置
- [ ] 创建订阅产品
- [ ] Checkout Session
- [ ] 支付成功回调
- [ ] Webhook 处理

#### 7.3 订阅管理
- [ ] 订阅状态追踪
- [ ] 升级/降级流程
- [ ] 取消订阅
- [ ] 发票管理

### 8. 搜索和过滤 🟡 P2

#### 8.1 搜索功能
- [ ] 全文搜索实现
- [ ] 搜索输入框
- [ ] 搜索结果高亮
- [ ] 搜索历史

#### 8.2 过滤器
- [ ] 按文档类型过滤
- [ ] 按状态过滤
- [ ] 按客户过滤
- [ ] 按日期范围过滤

#### 8.3 排序功能
- [ ] 按创建时间排序
- [ ] 按更新时间排序
- [ ] 按金额排序
- [ ] 按客户名排序

### 9. 邮件发送 🟢 P3

#### 9.1 邮件服务集成
- [ ] SendGrid / Resend 配置
- [ ] 邮件模板设计
- [ ] 附件处理 (PDF)

#### 9.2 发送功能
- [ ] 发送文档给客户
- [ ] 抄送自己
- [ ] 发送确认提示

#### 9.3 自动提醒
- [ ] 发票到期提醒
- [ ] 支付确认邮件
- [ ] 收据发送

---

## 🐛 Bug 修复清单

### 高优先级 Bug
- [ ] AI 生成失败时无错误提示
- [ ] 图片上传后刷新页面丢失
- [ ] 支付状态撤销窗口计时不准确
- [ ] 移动端预览区域滚动问题

### 中优先级 Bug
- [ ] 表单验证不完整
- [ ] Tab 切换时状态未保存
- [ ] 长文本溢出问题
- [ ] 日期选择器样式问题

### 低优先级 Bug
- [ ] Console 警告清理
- [ ] TypeScript 类型警告
- [ ] 无障碍性问题

---

## 🔧 技术债务清理

### 代码重构
- [ ] 提取公共组件
  - [ ] FormField 组件
  - [ ] DataTable 组件
  - [ ] EmptyState 组件
- [ ] 状态管理优化
  - [ ] 引入 Zustand/Jotai
  - [ ] 全局状态设计
  - [ ] 持久化状态
- [ ] API 层抽象
  - [ ] 创建 API 服务层
  - [ ] 统一错误处理
  - [ ] 请求拦截器

### 性能优化
- [ ] 图片懒加载
- [ ] 代码分割 (Code Splitting)
- [ ] 组件懒加载 (React.lazy)
- [ ] 预览组件虚拟化
- [ ] AI 请求缓存

### 类型安全
- [ ] 完善所有组件类型定义
- [ ] 移除 `any` 类型
- [ ] 添加严格模式
- [ ] API 响应类型定义

### 测试
- [ ] 单元测试 (Jest + Testing Library)
- [ ] 组件测试
- [ ] E2E 测试 (Playwright)
- [ ] API 测试

---

## 📊 进度追踪

### Phase 2 完成度: 0%

| 模块 | 进度 | 预计完成时间 |
|------|------|-------------|
| UI/UX 优化 | 0% | 2 周 |
| 数据持久化 | 0% | 1 周 |
| 用户认证 | 0% | 3 天 |
| 文档关联 | 0% | 3 天 |
| PDF 导出 | 0% | 2 天 |
| 公司设置 | 0% | 3 天 |
| 订阅系统 | 0% | 1 周 |
| 搜索过滤 | 0% | 2 天 |
| 邮件发送 | 0% | 2 天 |

---

## 🎨 设计参考

### 待提供的参考图片
- [ ] Dashboard 整体布局参考
- [ ] 统计卡片设计参考
- [ ] 编辑器布局参考
- [ ] 文档预览模板参考
- [ ] 移动端设计参考

### 设计资源
- [ ] Logo 设计 (SVG)
- [ ] 图标集 (Lucide Icons)
- [ ] 插图素材
- [ ] 品牌指南

---

## 📝 开发规范

### Git Commit 规范
```
feat: 新功能
fix: Bug 修复
docs: 文档更新
style: 代码格式化
refactor: 重构
perf: 性能优化
test: 测试
chore: 构建/工具链
```

### 分支策略
- `main`: 生产环境
- `develop`: 开发环境
- `feature/*`: 功能分支
- `fix/*`: 修复分支

### Code Review 检查点
- [ ] 代码符合规范
- [ ] 类型定义完整
- [ ] 无 console.log
- [ ] 无硬编码
- [ ] 错误处理完善
- [ ] 性能考虑
- [ ] 可访问性

---

## 🚀 部署计划

### 开发环境
- [ ] Vercel 部署配置
- [ ] 环境变量设置
- [ ] 预览部署

### 生产环境
- [ ] 域名配置
- [ ] SSL 证书
- [ ] CDN 配置
- [ ] 监控告警

---

## 📚 文档更新

### 需要维护的文档
- [x] PRD.md (产品需求文档)
- [x] ROADMAP.md (开发路线图)
- [ ] README.md (项目说明)
- [ ] CONTRIBUTING.md (贡献指南)
- [ ] API.md (API 文档)
- [ ] CHANGELOG.md (更新日志)

---

## 🔄 更新日志

### 2026-01-05
- 创建开发路线图
- 规划 Phase 2 任务
- 定义优先级和时间表

---

**下次更新**: 完成第一个功能模块后  
**负责人**: Johnson  
**最后更新**: 2026-01-05


